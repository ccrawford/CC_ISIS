# CC_ISIS Web Installer

A browser-based firmware installer for the CC_ISIS device, built with
[ESP Web Tools](https://esphome.github.io/esp-web-tools/).

Users can flash the firmware directly from Chrome or Edge — no driver
installation or command-line tools required on their end.

---

## Prerequisites (for building and publishing)

- [PlatformIO](https://platformio.org/) for compiling the firmware
- Python with `esptool` installed:

  ```
  pip install esptool
  ```

---

## Workflow

### 1. Build the firmware

From the project root:

```
pio run -e ccrawford_cc_isis_esp32s3
```

PlatformIO places the build artifacts in:

```
.pio/build/ccrawford_cc_isis_esp32s3/
  bootloader.bin       <- secondary bootloader
  partitions.bin       <- huge_app partition table
  <progname>.bin       <- application binary
```

### 2. Run the merge script

From the project root:

```
python create_web_installer.py [version]
```

**Examples:**

```
python create_web_installer.py              # uses VERSION env var or "0.0.1"
python create_web_installer.py 1.2.0       # explicit version
VERSION=1.2.0 python create_web_installer.py
```

The script:
- Runs `esptool merge_bin` to combine the bootloader, partition table, and
  application into a single `web-installer/firmware-merged.bin` starting at
  flash offset `0x0`.
- Updates the `"version"` field in `web-installer/manifest.json`.

### 3. Commit the updated files

```
git add web-installer/firmware-merged.bin
git add web-installer/manifest.json
git commit -m "Update web installer to v1.2.0"
git push
```

> `firmware-merged.bin` is a binary file and must be tracked by git for
> GitHub Pages to serve it. Make sure it is **not** in `.gitignore`.

---

## Hosting on GitHub Pages

1. Push the `web-installer/` folder (including `firmware-merged.bin`) to your
   repository on the `main` branch.

2. Go to **GitHub → your repository → Settings → Pages**.

3. Under *Source*, choose **Deploy from a branch**, select `main`, and set the
   folder to `/ (root)` (or use a `gh-pages` branch if you prefer).

4. Once Pages is enabled, the installer is reachable at:

   ```
   https://<username>.github.io/<repo>/web-installer/
   ```

5. Share that URL with users. They open it in Chrome or Edge, click
   **Install**, and the firmware flashes directly over USB.

---

## Testing locally

Python's built-in HTTP server works fine for local testing. Web Serial
requires `localhost` or `https`, so this is the easiest option:

```
cd web-installer
python -m http.server 8080
```

Then open `http://localhost:8080` in Chrome or Edge.

---

## Files

| File | Description |
|---|---|
| `index.html` | Installer web page (loads ESP Web Tools from CDN) |
| `manifest.json` | Chip family, firmware path, and version for ESP Web Tools |
| `firmware-merged.bin` | Single merged binary generated by `create_web_installer.py` |
| `../create_web_installer.py` | Script that produces the merged binary (run from project root) |

---

## Technical details

| Parameter | Value |
|---|---|
| Chip | ESP32-S3 |
| Flash mode | QIO |
| Flash frequency | 80 MHz |
| Bootloader offset | `0x0` *(ESP32-S3 — differs from classic ESP32's `0x1000`)* |
| Partition table offset | `0x8000` |
| Application offset | `0x10000` *(huge_app.csv)* |
